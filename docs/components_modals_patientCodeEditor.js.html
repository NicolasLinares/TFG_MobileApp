<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/modals/patientCodeEditor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/modals/patientCodeEditor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
* @fileoverview Contenido de patientCodeModal, permite añadir un código de paciente mediante textinput, escáner o seleccionándolo de la lista de filtros usados
*
* @version 1
* @author Nicolás Linares La Barba &lt;nlbarba97@gmail.com>
*/

import React, { Component } from 'react';
import {
    View,
    TextInput,
    Text,
    StyleSheet,
    TouchableOpacity,
    Alert,
} from 'react-native';

import { COLORS } from '_styles';
import IconII from "react-native-vector-icons/Ionicons";
import { HeaderButtons } from '_buttons';

import { connect } from 'react-redux';
import { setPatientTag } from '_redux_actions';

import { FilterList } from '_lists';

import { permissionsService, checkInputService } from '_services';


class PatientCodeEditor extends Component {

    constructor(props) {
        super(props);
        this.state = {
            tag: this.props.patientTag,
        };
    }

    handleAccept() {
        // Comprueba que no tiene espacios en blanco, tabulaciones, etc
        if (checkInputService.withBlankSpaces(this.state.tag)) {
            Alert.alert(
                'Código no válido',
                'Introduce un código de paciente sin espacios en blanco',
                [{ text: 'Aceptar' }]
            );
        } else {
            this.props.setPatientTag(this.state.tag);
            this.props.closeEditor();
        }
    }

    handleCancel() {
        this.props.closeEditor();
    }

    async handleScanner() {

        let granted = await permissionsService.checkCameraPermissions();

        if (granted) {
            this.props.nav.navigate('Scanner',
                {
                    setTag: (value) => {this.setState({ tag: value.slice(0, 32) })} // se acorta en caso de leer un código que supere los 32 caracteres
                }
            );
        }
    }

    _renderHelpMessage() {
        return (
            &lt;>
                &lt;View style={styles.iconContainer}>
                    &lt;IconII style={styles.icon} name={"person"} />
                    &lt;IconII style={[styles.icon, { marginLeft: -3 }]} name={"list"} />
                &lt;/View>

                &lt;Text style={styles.helpText}>
                    Escanea el código del paciente {'\n'}
                    o escribe un nuevo código para {'\n'}
                    identificar las notas de voz
                &lt;/Text>
            &lt;/>
        );
    }

    _renderInputCode() {
        return (
            &lt;View style={styles.inputContainer}>
                &lt;TextInput
                    maxLength={32}
                    underlineColorAndroid={'transparent'}
                    value={this.state.tag}
                    onChangeText={(value) => this.setState({ tag: value })}
                    placeholder='Escribe un código o escanéalo'
                    placeholderTextColor={COLORS.grey}
                    style={styles.textInput}
                />
                &lt;TouchableOpacity onPress={() => this.handleScanner()}>
                    &lt;IconII style={styles.scanIcon} name={'scan-circle'} />
                &lt;/TouchableOpacity>
            &lt;/View>
        );
    }

    _renderRecentCodes() {
        if (this.props.tags.length > 0)
            return (

                &lt;View style={{width: '100%'}}> 
                    &lt;Text style={styles.subtitle}>
                        Códigos recientes
                    &lt;/Text>

                    &lt;FilterList
                        data={this.props.tags}
                        onPressTag={(tag) => this.setState({ tag: tag })}
                    />

                &lt;/View>

            );
        else
            null;
    }

    render() {
        return (

            &lt;View style={styles.container}>

                &lt;View style={styles.header}>
                    {HeaderButtons.CloseButton(() => this.handleCancel())}
                    &lt;Text style={styles.title}> Código de paciente &lt;/Text>
                    {HeaderButtons.AcceptButton(() => this.handleAccept())}
                &lt;/View>

                {this._renderHelpMessage()}

                {this._renderInputCode()}

                {this._renderRecentCodes()}

            &lt;/View>

        )
    }
}

const styles = StyleSheet.create({
    container: {
        height: 450,
        alignItems: 'center',
        justifyContent: 'flex-start',
        backgroundColor: 'transparent',
    },
    header: {
        flexDirection: 'row',
        width: '90%',
        height: 80,
        justifyContent: 'space-between',
        alignItems: 'center',
        backgroundColor: 'transparent',
        marginBottom: 10
    },
    title: {
        fontSize: 18,
        fontWeight: 'bold'
    },
    helpText: {
        marginTop: 15,
        marginBottom: 30,
        fontSize: 13,
        color: COLORS.dark_grey,
        textAlign: 'center',
    },

    iconContainer: {
        flexDirection: 'row',
        width: 60,
        height: 60,
        borderRadius: 20,
        justifyContent: 'center',
        alignItems: 'center',
        backgroundColor: COLORS.light_green,
        borderWidth: 0.5,
        borderColor: COLORS.green
    },
    icon: {
        fontSize: 23,
        color: COLORS.green,
    },
    inputContainer: {
        flexDirection: 'row',
        width: '75%',
        height: 40,
        backgroundColor: COLORS.light_grey,
        borderRadius: 20,
        justifyContent: 'space-between',
        alignItems: 'center',
    },
    textInput: {
        width: '75%',
        marginLeft: 20,
        textAlign: 'center',
        fontSize: 14,
        color: COLORS.electric_blue,
    },
    scanIcon: {
        fontSize: 35,
        color: COLORS.electric_blue,
        marginRight: 5
    },
    subtitle: {
        marginTop: 40,
        marginBottom: 15,
        fontSize: 16,
        fontWeight: '400',
        alignSelf: 'center',
        color: 'rgb(40,40,40)',
    },
});


const mapStateToProps = (state) => {
    return {
        patientTag: state.patientCodeReducer.patientCode,
        tags: state.tagsReducer.tags,
    }
}

const mapDispatchToProps = (dispatch) => {
    return {
        setPatientTag: (tag) => dispatch(setPatientTag(tag)),
    }
}


export default connect(mapStateToProps, mapDispatchToProps)(PatientCodeEditor);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ContentMenu.html">ContentMenu</a></li><li><a href="DialogPrompt.html">DialogPrompt</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sun Dec 27 2020 10:53:23 GMT+0100 (Central European Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
